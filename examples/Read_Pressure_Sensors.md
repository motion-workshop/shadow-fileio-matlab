# Shadow Matlab Example: Read and Plot Foot Pressure Sensor Data 

[![Build Status](https://www.travis-ci.com/motion-workshop/shadow-fileio-matlab.svg?branch=main)](https://www.travis-ci.com/motion-workshop/shadow-fileio-matlab)

This document shows how to load a Shadow take in Matlab and plot the pressure sensor data for the heel and toe of the left foot.

## Body Segment Ids

When referencing Shadow body segments in the Matlab, you need to use the body segment id.  The mapping of id to body segment name can be found in each recordingâ€™s take.mTake file.  You can generate a Matlab mapping function by opening your web browser and going to the following url:  http://localhost:32080/?configuration=m 

The ids may change depending on how many sensor nodes are plugged in.  Below is an example output for the default full body with 17 sensors attached:

```matlab
%--------
%SHADOW_NODE_KEY Get a node index into a take from its symbolic name.
%
%   S = shadow_node_key()
%

%
% Automatically generated by the "node_to_m.lua" script. Input is a node
% configuration. The output is a Matalb function that returns a struct with
% symbolic node names.
%
% Intended for use with the shadow.header.range(...) function.
%

function [s] = shadow_node_key()
  s = struct();

  s.Body = 1;
  s.Chest = 2;
  s.Head = 3;
  s.HeadEnd = 4;
  s.Hips = 5;
  s.LeftArm = 6;
  s.LeftFinger = 7;
  s.LeftFingerEnd = 8;
  s.LeftFoot = 9;
  s.LeftForearm = 10;
  s.LeftHand = 11;
  s.LeftHeel = 12;
  s.LeftLeg = 13;
  s.LeftShoulder = 14;
  s.LeftThigh = 15;
  s.LeftToe = 16;
  s.LeftToeEnd = 17;
  s.Neck = 18;
  s.Reference = 19;
  s.RightArm = 20;
  s.RightFinger = 21;
  s.RightFingerEnd = 22;
  s.RightFoot = 23;
  s.RightForearm = 24;
  s.RightHand = 25;
  s.RightHeel = 26;
  s.RightLeg = 27;
  s.RightShoulder = 28;
  s.RightThigh = 29;
  s.RightToe = 30;
  s.RightToeEnd = 31;
  s.SpineLow = 32;
  s.SpineMid = 33;
  s.Tracker0 = 34;
  s.Tracker1 = 35;
  s.Tracker2 = 36;
  s.Tracker3 = 37;
end

%--------
```

## Example: Read and Plot Foot Pressure Sensor Data 

The following full example shows how to plot the pressure sensor data for the left foot:

```matlab
[A, header] = shadow.takeread();

% get the key map
S = shadow_node_key()

% Get the left foot node key in Shadow full body take
key = S.LeftFoot;
name = shadow.header.name();

% Find the pressure measurement channel
% note that this exists only in the LeftFoot and RightFoot nodes
p_range = shadow.header.range(header, key, name.p);
if isempty(p_range)
  error('no pressure measurement for the LeftFoot node');
end

% Number of samples, one per row
n = size(A, 1);

% Create a time axis in seconds
x = [0:n-1] * header.h;

% Plot pressure data, stored w,x,y,z
% w = heel, x = toe
plot(x, A(:, p_range(1:2)));
title('Pressure measurements for LeftFoot');
xlabel('Time (s)');
ylabel('Counts (pressure)');
legend('LeftFoot Heel', 'LeftFoot Toe');
```

## License

This project is distributed under a permissive [BSD License](LICENSE).